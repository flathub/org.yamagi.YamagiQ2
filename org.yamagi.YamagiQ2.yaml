app-id: org.yamagi.YamagiQ2
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "22.08"
command: YamagiQ2.sh
rename-icon: Quake2

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  - --share=ipc
  - --share=network
  - --socket=pulseaudio

  - --persist=.yq2

cleanup:
  - /include
  - /lib/*.a
  - /lib/*.la
  - /lib/pkgconfig

modules:
  - name: yamagi
    buildsystem: cmake-ninja
    no-make-install: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    build-commands:
      - mv ./release/ /app/bin/
      - install -Dm 644 ./stuff/icon/Quake2.svg /app/share/icons/hicolor/scalable/apps/Quake2.svg
    sources:
      - type: archive
        url: https://github.com/yquake2/yquake2/archive/refs/tags/QUAKE2_8_20.tar.gz
        sha256: 1a751e5a78148ee0a7dc6c73f856af57fa7b6cc07a52d30b094f88f4f76adf24

  - name: rogue
    buildsystem: cmake-ninja
    no-make-install: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    build-commands:
      - install -D ./game.so /app/bin/rogue/game.so
    sources:
      - type: archive
        url: https://github.com/yquake2/rogue/archive/refs/tags/ROGUE_2_10.tar.gz
        sha256: 8c9601d86b158f5cf6bf86b4dd2981ac7f21effe2eb7421d9a6a4798b72e8fd1

  - name: xatrix
    buildsystem: cmake-ninja
    no-make-install: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    build-commands:
      - install -D ./game.so /app/bin/xatrix/game.so
    sources:
      - type: archive
        url: https://github.com/yquake2/xatrix/archive/refs/tags/XATRIX_2_11.tar.gz
        sha256: b47a31b6556c480451e87020cbcffdb21fa546b2751d25e7960658bf1aadec75

  - name: zaero
    buildsystem: cmake-ninja
    no-make-install: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    build-commands:
      - install -D ./game.so /app/bin/zaero/game.so
    sources:
      - type: git
        url: https://github.com/yquake2/zaero.git
        branch: master
        commit: 2f785750867730011e01dbcfb9644133d03bee39        

  - name: ctf
    buildsystem: cmake-ninja
    no-make-install: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    build-commands:
      - install -D ./game.so /app/bin/ctf/game.so
    sources:
      - type: archive
        url: https://github.com/yquake2/ctf/archive/refs/tags/CTF_1_09.tar.gz
        sha256: 5c7877e48cc55887485aa134e8dc42afdbf45354306cfa8179628d08c6da1c7b

  - name: vulkan
    buildsystem: simple
    build-commands:
      - make
      - install -D ./release/ref_vk.so /app/bin/ref_vk.so
    sources:
      - type: archive
        url: https://github.com/yquake2/ref_vk/archive/refs/tags/v1.0.5.tar.gz
        sha256: f1f930ff900908c2caeb1b66a6c17b2fdd4272cdeb61253d0342f0e28c26290e

  - name: launcher
    buildsystem: simple
    sources:
      - type: script
        dest-filename: YamagiQ2.sh
        commands:
          - ls ~/.yq2/baseq2/pak0.pak || zenity --error --text "Game data (/baseq2/ etc.)  must be added to:\n~/.var/app/org.yamagi.YamagiQ2/.yq2/baseq2/" --ok-label "Close" --width=400
          - /app/bin/quake2 "$@"
      - type: file
        path: org.yamagi.YamagiQ2.desktop
      - type: file
        path: org.yamagi.YamagiQ2.appdata.xml
    build-commands:
      - install -Dm 744 YamagiQ2.sh -t /app/bin
      - install -Dm 644 org.yamagi.YamagiQ2.desktop -t /app/share/applications
      - install -Dm 644 org.yamagi.YamagiQ2.appdata.xml -t /app/share/metainfo

