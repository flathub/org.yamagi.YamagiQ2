app-id: org.yamagi.YamagiQ2
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "20.08"
command: YamagiQ2.sh

finish-args:
- --device=dri
- --socket=wayland
- --socket=fallback-x11
- --socket=x11
- --share=ipc
- --share=network
- --socket=pulseaudio

- --persist=.yq2

cleanup:
- /app/include
- /app/lib/*.a
- /app/lib/*.la
- /app/lib/pkgconfig

modules:
- name: yamagi
  buildsystem: cmake-ninja
  no-make-install: true
  config-opts:
  - -DCMAKE_BUILD_TYPE=RelWithDebInfo
  build-commands:
  - mv ./release/ /app/bin/
  sources:
  - type: archive
    url: https://github.com/yquake2/yquake2/archive/QUAKE2_7_45.tar.gz
    sha256: 9b5991295d617fdd1a27fd6d49c2e6f2e81ad71286d03fda3193d974b37f7c34

- name: rogue
  buildsystem: cmake-ninja
  no-make-install: true
  config-opts:
  - -DCMAKE_BUILD_TYPE=RelWithDebInfo
  build-commands:
  - install -D ./game.so /app/bin/rogue/game.so
  sources:
  - type: archive
    url: https://github.com/yquake2/rogue/archive/ROGUE_2_07.tar.gz
    sha256: eb102d77fc6ec2765c7cc57205bb704bc710b97e7d53ef5b1017e8a960c7e180
    
- name: xatrix
  buildsystem: cmake-ninja
  no-make-install: true
  config-opts:
  - -DCMAKE_BUILD_TYPE=RelWithDebInfo
  build-commands:
  - install -D ./game.so /app/bin/xatrix/game.so
  sources:
  - type: archive
    url: https://github.com/yquake2/xatrix/archive/XATRIX_2_08.tar.gz
    sha256: 2f28b8bbf278f08112816a4098b001f662ad19e6c4cc4b132c57e7900eff90cf

- name: ctf
  buildsystem: cmake-ninja
  no-make-install: true
  config-opts:
  - -DCMAKE_BUILD_TYPE=RelWithDebInfo
  build-commands:
  - install -D ./game.so /app/bin/ctf/game.so
  sources:
  - type: archive
    url: https://github.com/yquake2/ctf/archive/CTF_1_07.tar.gz
    sha256: bd178e6712f06490286e6389e801d02f2b3d7ab9f488543ac2900d9c24b98168

- name: launcher
  buildsystem: simple
  sources:
  - type: script
    dest-filename: YamagiQ2.sh
    commands:
    - ls ~/.yq2/baseq2/pak0.pak || zenity --error --text "Game data (/baseq2/ etc.)  must be added to:\n~/.var/app/org.yamagi.YamagiQ2/.yq2/baseq2/" --ok-label "Close" --width=400
    - /app/bin/quake2 "$@"
  - type: file
    path: org.yamagi.YamagiQ2.desktop
  - type: file
    path: org.yamagi.YamagiQ2.appdata.xml
  - type: file
    path: org.yamagi.YamagiQ2.svg
  build-commands:
  - install -Dm 744 YamagiQ2.sh -t /app/bin
  - install -Dm 644 org.yamagi.YamagiQ2.desktop -t /app/share/applications
  - install -Dm 644 org.yamagi.YamagiQ2.appdata.xml -t /app/share/metainfo
  - install -Dm 644 org.yamagi.YamagiQ2.svg /app/share/icons/hicolor/scalable/apps/org.yamagi.YamagiQ2.svg


